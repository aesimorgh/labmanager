{% extends "base_user_panel.html" %}
{% load static %}

{% block title %}ØªÙ†Ø¸ÛŒÙ…Ø§Øª{% endblock %}

{% block head_extra %}
<style>
  /* Ù¾Ø§ÛŒÙ‡â€ŒÛŒ Ø³Ø§Ù„Ù… Ø¨Ø±Ø§ÛŒ Ø§Ù†Ø¯Ø§Ø²Ù‡â€ŒÚ¯ÛŒØ±ÛŒâ€ŒÙ‡Ø§ Ùˆ Ø´Ú©Ø³Øª Ù…ØªÙ†â€ŒÙ‡Ø§ÛŒ Ø¨Ù„Ù†Ø¯ */
  *, *::before, *::after { box-sizing: border-box; }
  img { max-width: 100%; height: auto; }
  .wrap{direction:rtl;max-width:1200px;margin:0 auto;display:grid;gap:1.25rem}
  .heading{font-weight:800;font-size:1.25rem;margin:.25rem 0 .5rem}
  .sub{color:#6b7280;margin-top:-.25rem}

  /* Ø´Ø¨Ú©Ù‡Ù” Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ */
  .grid{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(380px,1fr));
    gap:1.25rem;
    align-items:start; /* Ù‡Ø± Ú©Ø§Ø±Øª Ù…Ø³ØªÙ‚Ù„ Ø¨Ø§ÛŒØ³ØªØ¯ */
  }
  .card{
    border:1px solid #e5e7eb;background:#fff;border-radius:.9rem;
    box-shadow:0 4px 14px rgba(0,0,0,.05);
    overflow:hidden;           /* Ù…Ø­ØªÙˆØ§ÛŒ Ø¨ÛŒØ±ÙˆÙ†â€ŒØ²Ù† Ú©Ù†ØªØ±Ù„ Ø´ÙˆØ¯ */
  }
  .card-h{padding:.75rem 1rem;border-bottom:1px solid #e5e7eb;font-weight:700}
  .card-b{
    padding:1rem;
    overflow-wrap:anywhere;    /* Ù„ÛŒÙ†Ú©/Ù…ØªÙ†â€ŒÙ‡Ø§ÛŒ Ø·ÙˆÙ„Ø§Ù†ÛŒ Ú©Ø§Ø±Øª Ú©Ù†Ø§Ø±ÛŒ Ø±Ø§ Ù‡Ù„ Ù†Ø¯Ù‡Ù†Ø¯ */
    word-break:break-word;
  }

  /* Ø±Ø¯ÛŒÙâ€ŒÙ‡Ø§ÛŒ ÙØ±Ù… */
  .row{
    display:grid;grid-template-columns:170px 1fr;
    gap:.9rem;align-items:center;margin:.75rem 0
  }
  .row label{color:#374151;font-weight:700;white-space:nowrap}
  @media (max-width:740px){
    .row{grid-template-columns:1fr}
    .row label{margin-bottom:.25rem;white-space:normal}
  }

  /* Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§: Ù‡Ù…Ø§Ù‡Ù†Ú¯ Ùˆ Ù…Ø­Ø¯ÙˆØ¯ Ø¨Ù‡ Ú©Ø§Ø±Øª */
  .row input[type="text"], .row input[type="tel"], .row input[type="email"],
  .row select, .row textarea, .form-control{
    border:1px solid #e5e7eb;border-radius:.6rem;padding:.6rem .75rem;
    width:100%;max-width:100%;background:#fff;outline:none;
    transition:border-color .15s, box-shadow .15s
  }
  .row input:focus, .row select:focus, .row textarea:focus, .form-control:focus{
    border-color:#111827; box-shadow:0 0 0 3px rgba(17,24,39,.1)
  }

  /* Ø³ÙˆÛŒÛŒÚ† Ùˆ Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ */
  .kpi-preview{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:.5rem;margin-top:.25rem}
  .pill{display:inline-flex;gap:.4rem;align-items:center;padding:.3rem .65rem;border:1px solid #e5e7eb;border-radius:999px;background:#fff}
  .muted{color:#6b7280}

  /* Ø³ÙˆÛŒÛŒÚ† */
  .switch{display:inline-flex;align-items:center;gap:.5rem;cursor:pointer}
  .switch input{display:none}
  .switch .track{width:46px;height:24px;background:#e5e7eb;border-radius:999px;position:relative;transition:.15s}
  .switch .thumb{position:absolute;top:3px;left:3px;width:18px;height:18px;background:#fff;border-radius:50%;box-shadow:0 1px 2px rgba(0,0,0,.15);transition:.15s}
  .switch input:checked + .track{background:#111827}
  .switch input:checked + .track .thumb{left:25px}

  /* Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ */
  .actions{display:flex;gap:.6rem;flex-wrap:wrap;margin-top:1rem}
  .btn{display:inline-block;padding:.6rem .95rem;border:1px solid #e5e7eb;border-radius:.6rem;text-decoration:none;color:#111827;background:#fff}
  .btn:hover{background:#f8fafc}
  .btn.primary{background:#111827;color:#fff;border-color:#111827}
  .btn.primary:hover{filter:brightness(1.05)}

  /* Ù†ÙˆØªÛŒØ³ Ùˆ Toast */
  .note{background:#fffbeb;border:1px solid #fde68a;color:#92400e;padding:.7rem .9rem;border-radius:.6rem;margin:.75rem 0}

  /* --- Ø§ÙØ²ÙˆØ¯Ù‡â€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø®Ø·Ø§Ù‡Ø§ --- */
  .errorlist{margin:.25rem 0 0;padding:0;list-style:none;color:#b91c1c;font-size:.85rem}
  .errorlist li{margin:0}
  .help.error{color:#b91c1c}
  .field-error input[type="text"],
  .field-error input[type="tel"],
  .field-error input[type="email"],
  .field-error select,
  .field-error textarea,
  .field-error .form-control{
    border-color:#b91c1c !important;
    box-shadow:0 0 0 3px rgba(185,28,28,.12) !important;
  }
</style>
{% endblock %}

{% block subtabs %}
<ul class="nav nav-pills mb-3">
  <li class="nav-item"><a class="nav-link" href="{% url 'core:orders_home' %}">Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§</a></li>
  <li class="nav-item"><a class="nav-link" href="{% url 'billing:financial_home' %}">Ù…Ø§Ù„ÛŒ</a></li>
  <li class="nav-item"><a class="nav-link active" href="{% url 'settings_app:settings_home' %}">ØªÙ†Ø¸ÛŒÙ…Ø§Øª</a></li>
</ul>
{% endblock %}

{% block content %}
<div class="wrap">
  <div>
    <div class="heading">ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø³Ø§Ù…Ø§Ù†Ù‡</div>
    <div class="sub">Ø§ÛŒÙ† ØµÙØ­Ù‡ ÙØ¹Ù„Ø§Ù‹ ÙÙ‚Ø· Ø±Ø§Ø¨Ø· Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø¯Ø§Ø±Ø¯Ø› Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡Ù” ÙˆØ§Ù‚Ø¹ÛŒØŒ Ø¨Ø¹Ø¯Ø§Ù‹ Ø¨Ù‡ Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ù…ØªØµÙ„ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ….</div>
  </div>
  <div class="grid">
      <!-- ÙØ±Ù… Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³ -->
  <div class="card">
    <div class="card-h">Ø°Ø®ÛŒØ±Ù‡Ù” Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³</div>
    <div class="card-b">
      <form method="post" enctype="multipart/form-data" action="">
        {% csrf_token %}

        {% if form.non_field_errors %}
          <ul class="errorlist">
            {% for err in form.non_field_errors %}<li>{{ err }}</li>{% endfor %}
          </ul>
        {% endif %}

        <div class="row">
          <label for="{{ form.name.id_for_label }}">Ù†Ø§Ù… Ù„Ø§Ø¨Ø±Ø§ØªÙˆØ§Ø±</label>
          <div class="{% if form.name.errors %}field-error{% endif %}">{{ form.name }}
            {% if form.name.errors %}
              <ul class="errorlist">{% for e in form.name.errors %}<li>{{ e }}</li>{% endfor %}</ul>
            {% endif %}
          </div>
        </div>

        <div class="row">
          <label for="{{ form.slogan.id_for_label }}">Ø´Ø¹Ø§Ø±</label>
          <div class="{% if form.slogan.errors %}field-error{% endif %}">{{ form.slogan }}
            {% if form.slogan.errors %}
              <ul class="errorlist">{% for e in form.slogan.errors %}<li>{{ e }}</li>{% endfor %}</ul>
            {% endif %}
          </div>
        </div>

        <div class="row">
          <label for="{{ form.logo_file.id_for_label }}">Ù„ÙˆÚ¯Ùˆ (ÙØ§ÛŒÙ„)</label>
          <div class="{% if form.logo_file.errors %}field-error{% endif %}">{{ form.logo_file }}
            {% if form.logo_file.errors %}
              <ul class="errorlist">{% for e in form.logo_file.errors %}<li>{{ e }}</li>{% endfor %}</ul>
            {% endif %}
          </div>
        </div>

        <div class="row">
          <label for="{{ form.logo_static_path.id_for_label }}">Ù…Ø³ÛŒØ± Ø§Ø³ØªØ§ØªÛŒÚ© Ù„ÙˆÚ¯Ùˆ</label>
          <div class="{% if form.logo_static_path.errors %}field-error{% endif %}">
            {{ form.logo_static_path }}
            {% if form.logo_static_path.errors %}
              <ul class="errorlist">{% for e in form.logo_static_path.errors %}<li>{{ e }}</li>{% endfor %}</ul>
            {% endif %}
            <div class="help">Ù…Ø«Ø§Ù„: <code>img/academy-logo.png</code> (Ø¨Ø±Ø§ÛŒ {% templatetag openblock %} static {% templatetag closeblock %})</div>
          </div>
        </div>

        <div class="row">
          <label for="{{ form.card_no.id_for_label }}">Ø´Ù…Ø§Ø±Ù‡ Ú©Ø§Ø±Øª</label>
          <div class="{% if form.card_no.errors %}field-error{% endif %}">{{ form.card_no }}
            {% if form.card_no.errors %}
              <ul class="errorlist">{% for e in form.card_no.errors %}<li>{{ e }}</li>{% endfor %}</ul>
            {% endif %}
          </div>
        </div>

        <div class="row">
          <label for="{{ form.iban.id_for_label }}">Ø´Ù…Ø§Ø±Ù‡ Ø´ÙØ¨Ø§</label>
          <div class="{% if form.iban.errors %}field-error{% endif %}">{{ form.iban }}
            {% if form.iban.errors %}
              <ul class="errorlist">{% for e in form.iban.errors %}<li>{{ e }}</li>{% endfor %}</ul>
            {% endif %}
          </div>
        </div>

        <div class="row">
          <label for="{{ form.account_name.id_for_label }}">Ø¨Ù‡ Ù†Ø§Ù…</label>
          <div class="{% if form.account_name.errors %}field-error{% endif %}">{{ form.account_name }}
            {% if form.account_name.errors %}
              <ul class="errorlist">{% for e in form.account_name.errors %}<li>{{ e }}</li>{% endfor %}</ul>
            {% endif %}
          </div>
        </div>

        <div class="actions">
          <button type="submit" class="btn primary">Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³</button>
          <a href="" class="btn">Ø§Ù†ØµØ±Ø§Ù</a>
        </div>
      </form>
    </div>
  </div>
    <!-- Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø¬Ù…ÙˆØ¹Ù‡ -->
    <div class="card">
      <div class="card-h">Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø¬Ù…ÙˆØ¹Ù‡</div>
      <div class="card-b">
        {% if lab_profile %}
  <div class="row">
    <label>Ù†Ø§Ù…/Ø´Ø¹Ø§Ø±</label>
    <div>
      <div><strong>{{ lab_profile.name }}</strong>{% if lab_profile.slogan %} â€” <span class="muted">{{ lab_profile.slogan }}</span>{% endif %}</div>
      <div class="help">Ø§ÛŒÙ† Ø¨Ø®Ø´ ÙÙ‚Ø· Ù†Ù…Ø§ÛŒØ´ Ø§Ø² Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø§Ø³ØªØ› ÙØ±Ù…â€ŒÙ‡Ø§ÛŒ Ù¾Ø§ÛŒÛŒÙ† Ù‡Ù†ÙˆØ² Ø¨Ù‡ DB ÙˆØµÙ„ Ù†ÛŒØ³ØªÙ†Ø¯.</div>
    </div>
  </div>
  <div class="row">
    <label>Ù„ÙˆÚ¯Ùˆ</label>
    <div>
      {% with lf=lab_profile.get_logo_url %}
        {% if lf %}
          <img src="{{ lf }}" alt="logo" style="max-height:48px">
        {% elif lab_profile.logo_static_path %}
          <img src="{% static lab_profile.logo_static_path %}" alt="logo" style="max-height:48px">
        {% else %}
          <span class="muted">Ù„ÙˆÚ¯Ùˆ ØªÙ†Ø¸ÛŒÙ… Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª</span>
        {% endif %}
      {% endwith %}
    </div>
  </div>
  <div class="row">
    <label>Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø§Ù†Ú©ÛŒ</label>
    <div class="muted">
      {% if lab_profile.card_no %}Ú©Ø§Ø±Øª: {{ lab_profile.card_no }}{% endif %}
      {% if lab_profile.iban %}{% if lab_profile.card_no %} â€” {% endif %}Ø´Ø¨Ø§: {{ lab_profile.iban }}{% endif %}
      {% if not lab_profile.card_no and not lab_profile.iban %}Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡{% endif %}
      {% if lab_profile.account_name %}<div>Ø¨Ù‡ Ù†Ø§Ù…: {{ lab_profile.account_name }}</div>{% endif %}
    </div>
  </div>
{% else %}
  <div class="note">Ù‡Ù†ÙˆØ² Lab profile Ø¯Ø± Ø³ÛŒØ³ØªÙ… Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª. Ø§Ø² Â«Ø§Ø¯Ù…ÛŒÙ†Â» ÛŒÚ© Ù…ÙˆØ±Ø¯ Ø¨Ø³Ø§Ø².</div>
{% endif %}
        <div class="row">
          <label for="lab_name">Ù†Ø§Ù… Ù„Ø§Ø¨Ø±Ø§ØªÙˆØ§Ø±</label>
          <div>
            <input id="lab_name" type="text" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ù„Ø§Ø¨Ø±Ø§ØªÙˆØ§Ø± Ø¯Ù†Ø¯Ø§Ù†Ø³Ø§Ø²ÛŒâ€¦">
            <div class="help">Ø¯Ø± Ø³Ø±Ø¨Ø±Ú¯â€ŒÙ‡Ø§ Ùˆ Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.</div>
          </div>
        </div>
        <div class="row">
          <label for="lab_phone">ØªÙ„ÙÙ†</label>
          <div><input id="lab_phone" type="tel" placeholder="Ù…Ø«Ù„Ø§Ù‹: 021-xxxxxxx"></div>
        </div>
        <div class="row">
          <label for="lab_email">Ø§ÛŒÙ…ÛŒÙ„</label>
          <div><input id="lab_email" type="email" placeholder="info@example.com"></div>
        </div>
        <div class="row">
          <label for="lab_addr">Ø¢Ø¯Ø±Ø³</label>
          <div><textarea id="lab_addr" rows="2" placeholder="Ù†Ø´Ø§Ù†ÛŒ Ú©Ø§Ù…Ù„â€¦"></textarea></div>
        </div>
      </div>
    </div>

    <!-- ØªØ±Ø¬ÛŒØ­Ø§Øª Ù†Ù…Ø§ÛŒØ´ -->
    <div class="card">
      <div class="card-h">ØªØ±Ø¬ÛŒØ­Ø§Øª Ù†Ù…Ø§ÛŒØ´</div>
      <div class="card-b">
        <div class="row">
          <label>ØªÙ‚ÙˆÛŒÙ…</label>
          <div>
            <label class="pill"><input type="radio" name="calendar" value="jalali" checked> Ø¬Ù„Ø§Ù„ÛŒ</label>
            <label class="pill"><input type="radio" name="calendar" value="gregorian"> Ù…ÛŒÙ„Ø§Ø¯ÛŒ</label>
            <div class="help">ÙÙ‚Ø· UI â€” Ù…Ù†Ø·Ù‚ Ø§ØµÙ„ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù‡Ù…Ø§Ù†â€ŒØ·ÙˆØ± Ú©Ù‡ Ù‡Ø³Øª Ù…ÛŒâ€ŒÙ…Ø§Ù†Ø¯.</div>
          </div>
        </div>
        <div class="row">
          <label>Ù‚Ø§Ù„Ø¨ Ø§Ø¹Ø¯Ø§Ø¯</label>
          <div>
            <label class="pill"><input type="radio" name="digits" value="fa" checked> ÙØ§Ø±Ø³ÛŒ</label>
            <label class="pill"><input type="radio" name="digits" value="en"> Ù„Ø§ØªÛŒÙ†</label>
          </div>
        </div>
        <div class="row">
          <label>Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</label>
          <div class="kpi-preview">
            <label class="switch">
              <input id="show_overdue" type="checkbox" checked><span class="track"><span class="thumb"></span></span>
              <span>Ù†Ù…Ø§ÛŒØ´ Â«Ù…Ø¹ÙˆÙ‚Â»</span>
            </label>
            <label class="switch">
              <input id="show_tomorrow" type="checkbox" checked><span class="track"><span class="thumb"></span></span>
              <span>Ù†Ù…Ø§ÛŒØ´ Â«ØªØ­ÙˆÛŒÙ„â€ŒÙ‡Ø§ÛŒ ÙØ±Ø¯Ø§Â»</span>
            </label>
          </div>
          <div class="help">ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ Ø¯Ø± Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯Ø› Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ ØªØºÛŒÛŒØ± Ù†Ù…ÛŒâ€ŒÚ©Ù†Ù†Ø¯.</div>
        </div>
      </div>
    </div>

    <!-- Ø§Ø¹Ù„Ø§Ù†â€ŒÙ‡Ø§ -->
    <div class="card">
      <div class="card-h">Ø§Ø¹Ù„Ø§Ù†â€ŒÙ‡Ø§</div>
      <div class="card-b">
        <div class="row">
          <label>ÛŒØ§Ø¯Ø¢ÙˆØ±ÛŒ Ù…ÙˆØ¹Ø¯ ØªØ­ÙˆÛŒÙ„</label>
          <div>
            <label class="switch">
              <input id="notif_due" type="checkbox" checked><span class="track"><span class="thumb"></span></span>
              <span>ÙØ¹Ø§Ù„</span>
            </label>
            <div class="help">ÙØ¹Ù„Ø§Ù‹ ÙÙ‚Ø· ØªÙ†Ø¸ÛŒÙ… Ø¸Ø§Ù‡Ø±ÛŒ Ø§Ø³ØªØ› Ø¨Ø¹Ø¯Ø§Ù‹ Ø²Ù…Ø§Ù†â€ŒØ¨Ù†Ø¯ÛŒ ÙˆØ§Ù‚Ø¹ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ….</div>
          </div>
        </div>
        <div class="row">
          <label for="notif_time">Ø³Ø§Ø¹Øª Ø§Ø±Ø³Ø§Ù„</label>
          <div><input id="notif_time" type="text" placeholder="Ù…Ø«Ù„Ø§Ù‹ 09:00"></div>
        </div>
        <div class="row">
          <label>Ú©Ø§Ù†Ø§Ù„</label>
          <div>
            <label class="pill"><input type="checkbox" id="ch_inapp" checked> Ø¯Ø§Ø®Ù„ Ø¨Ø±Ù†Ø§Ù…Ù‡</label>
            <label class="pill"><input type="checkbox" id="ch_email"> Ø§ÛŒÙ…ÛŒÙ„</label>
            <label class="pill"><input type="checkbox" id="ch_sms"> Ù¾ÛŒØ§Ù…Ú©</label>
          </div>
        </div>
      </div>
    </div>

    <!-- Ø³Ø§ÛŒØ± -->
    <div class="card">
      <div class="card-h">Ø³Ø§ÛŒØ±</div>
      <div class="card-b">
        <div class="row">
          <label>Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ÛŒ Ù…ÙÛŒØ¯</label>
          <div class="actions">
            <a class="btn" href="{% url 'core:orders_home' %}">ğŸ“‹ Ù„ÛŒØ³Øª Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§</a>
            <a class="btn" href="{% url 'billing:report_open_invoices' %}">ğŸ’³ Ù…Ø·Ø§Ù„Ø¨Ø§Øª Ø¨Ø§Ø²</a>
            <a class="btn" href="{% url 'core:dashboard' %}">ğŸ  Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</a>
          </div>
        </div>
        <div class="note">
          â“˜ Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø§ÛŒÙ† ØµÙØ­Ù‡ ÙØ¹Ù„Ø§Ù‹ ÙÙ‚Ø· Ø¯Ø± Ù…Ø±ÙˆØ±Ú¯Ø± Ø´Ù…Ø§ Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒâ€ŒØ´ÙˆØ¯. Ø¯Ø± Ú¯Ø§Ù… Ø¨Ø¹Ø¯ÛŒ Ø°Ø®ÛŒØ±Ù‡Ù” Ù¾Ø§ÛŒØ¯Ø§Ø± Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø±Ø§ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ….
        </div>
      </div>
    </div>
  </div>

  <!-- Ø§Ú©Ø´Ù†â€ŒÙ‡Ø§ -->
  <div class="actions">
    <button id="save-local" class="btn primary">Ø°Ø®ÛŒØ±Ù‡Ù” Ù…ÙˆÙ‚Øª Ø¯Ø± Ù…Ø±ÙˆØ±Ú¯Ø±</button>
    <button id="reset-local" class="btn">Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø¨Ù‡ Ø­Ø§Ù„Øª Ø§ÙˆÙ„ÛŒÙ‡</button>
  </div>

  <div id="toast" class="muted" style="display:none;margin-top:.5rem"></div>
</div>

<script>
(function(){
  const KEY = "lm_settings_v1";
  const $ = sel => document.querySelector(sel);

  const fields = {
    lab_name:   $("#lab_name"),
    lab_phone:  $("#lab_phone"),
    lab_email:  $("#lab_email"),
    lab_addr:   $("#lab_addr"),
    calendar:   () => document.querySelector('input[name="calendar"]:checked'),
    digits:     () => document.querySelector('input[name="digits"]:checked'),
    show_overdue: $("#show_overdue"),
    show_tomorrow: $("#show_tomorrow"),
    notif_due:  $("#notif_due"),
    notif_time: $("#notif_time"),
    ch_inapp:   $("#ch_inapp"),
    ch_email:   $("#ch_email"),
    ch_sms:     $("#ch_sms"),
  };

  function showToast(msg){
    const t = $("#toast");
    t.textContent = msg;
    t.style.display = "block";
    setTimeout(()=> t.style.display = "none", 3000);
  }

  function load(){
    try{
      const raw = localStorage.getItem(KEY);
      if(!raw) return;
      const v = JSON.parse(raw);

      if(fields.lab_name)  fields.lab_name.value  = v.lab_name  || "";
      if(fields.lab_phone) fields.lab_phone.value = v.lab_phone || "";
      if(fields.lab_email) fields.lab_email.value = v.lab_email || "";
      if(fields.lab_addr)  fields.lab_addr.value  = v.lab_addr  || "";

      if(v.calendar){
        const r = document.querySelector('input[name="calendar"][value="'+v.calendar+'"]');
        if(r) r.checked = true;
      }
      if(v.digits){
        const r = document.querySelector('input[name="digits"][value="'+v.digits+'"]');
        if(r) r.checked = true;
      }

      if(fields.show_overdue)   fields.show_overdue.checked   = !!v.show_overdue;
      if(fields.show_tomorrow)  fields.show_tomorrow.checked  = !!v.show_tomorrow;
      if(fields.notif_due)      fields.notif_due.checked      = !!v.notif_due;
      if(fields.notif_time)     fields.notif_time.value       = v.notif_time || "";
      if(fields.ch_inapp)       fields.ch_inapp.checked       = !!v.ch_inapp;
      if(fields.ch_email)       fields.ch_email.checked       = !!v.ch_email;
      if(fields.ch_sms)         fields.ch_sms.checked         = !!v.ch_sms;
    }catch(e){}
  }

  function save(){
    const val = {
      lab_name:   fields.lab_name?.value || "",
      lab_phone:  fields.lab_phone?.value || "",
      lab_email:  fields.lab_email?.value || "",
      lab_addr:   fields.lab_addr?.value || "",
      calendar:   fields.calendar()?.value || "jalali",
      digits:     fields.digits()?.value || "fa",
      show_overdue:  !!fields.show_overdue?.checked,
      show_tomorrow: !!fields.show_tomorrow?.checked,
      notif_due:  !!fields.notif_due?.checked,
      notif_time: fields.notif_time?.value || "",
      ch_inapp:   !!fields.ch_inapp?.checked,
      ch_email:   !!fields.ch_email?.checked,
      ch_sms:     !!fields.ch_sms?.checked,
    };
    localStorage.setItem(KEY, JSON.stringify(val));
    showToast("ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ù‡â€ŒØµÙˆØ±Øª Ù…ÙˆÙ‚Øª Ø¯Ø± Ù…Ø±ÙˆØ±Ú¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.");
  }

  function reset(){
    localStorage.removeItem(KEY);
    document.querySelectorAll('input[type="text"], input[type="tel"], input[type="email"], textarea').forEach(el=> el.value = "");
    document.querySelector('input[name="calendar"][value="jalali"]').checked = true;
    document.querySelector('input[name="digits"][value="fa"]').checked = true;
    if(fields.show_overdue) fields.show_overdue.checked = true;
    if(fields.show_tomorrow) fields.show_tomorrow.checked = true;
    if(fields.notif_due) fields.notif_due.checked = true;
    if(fields.notif_time) fields.notif_time.value = "";
    if(fields.ch_inapp) fields.ch_inapp.checked = true;
    if(fields.ch_email) fields.ch_email.checked = false;
    if(fields.ch_sms) fields.ch_sms.checked = false;
    showToast("Ø¨Ù‡ Ø­Ø§Ù„Øª Ø§ÙˆÙ„ÛŒÙ‡ Ø¨Ø±Ú¯Ø´Øª.");
  }

  document.addEventListener('DOMContentLoaded', ()=>{
    load();
    const btnSave = document.getElementById('save-local');
    const btnReset = document.getElementById('reset-local');
    if(btnSave) btnSave.addEventListener('click', save);
    if(btnReset) btnReset.addEventListener('click', reset);
  });
})();
</script>
{% endblock %}


