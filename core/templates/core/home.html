<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <title>Lab Manager</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/persian-datepicker@1.2.0/dist/css/persian-datepicker.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/persian-datepicker@1.2.0/dist/js/persian-datepicker.min.js"></script>
    <style>
        body { font-family: Tahoma, sans-serif; padding: 20px; }
        h1, h2 { margin-top: 30px; }
        table { border-collapse: collapse; width: 100%; margin-top: 10px; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        th { background-color: #f4f4f4; }
        form { margin-bottom: 30px; }
        button { margin-top: 10px; padding: 5px 15px; }
    </style>
</head>
<body>
    <h1>مدیریت سفارش‌ها</h1>

    <!-- فرم ثبت سفارش -->
    <h2>ثبت سفارش</h2>
    <form method="post">
        {% csrf_token %}
        {{ order_form.as_p }}
        <button type="submit">ثبت سفارش</button>
    </form>

    <!-- فرم ثبت مواد -->
    <h2>ثبت مواد</h2>
    <form method="post">
        {% csrf_token %}
        {{ material_form.as_p }}
        <button type="submit">ثبت مواد</button>
    </form>

    <!-- فرم ثبت پرداخت -->
    <h2>ثبت پرداخت</h2>
    <form method="post">
        {% csrf_token %}
        {{ payment_form.as_p }}
        <button type="submit">ثبت پرداخت</button>
    </form>

    <!-- نمایش لیست سفارش‌ها -->
    <h2>لیست سفارش‌ها</h2>
    <table>
        <tr>
            <th>ID</th>
            <th>بیمار</th>
            <th>پزشک</th>
            <th>نوع سفارش</th>
            <th>تعداد واحد</th>
            <th>شماره سریال</th>
            <th>قیمت به ازای هر واحد</th>
            <th>قیمت کل</th>
            <th>رنگ</th>
            <th>وضعیت</th>
            <th>تاریخ تحویل</th>
            <th>تاریخ ایجاد</th>
        </tr>
        {% for order in orders %}
        <tr>
            <td>{{ order.id }}</td>
            <td>{{ order.patient_name }}</td>
            <td>{{ order.doctor }}</td>
            <td>{{ order.get_order_type_display }}</td>
            <td>{{ order.unit_count }}</td>
            <td>{{ order.serial_number }}</td>
            <td>{{ order.price }}</td>
            <td>{{ order.total_price }}</td>
            <td>{{ order.shade }}</td>
            <td>{{ order.get_status_display }}</td>
            <td>{{ order.due_date }}</td>
            <td>{{ order.created_at|date:"Y/m/d H:i" }}</td>
        </tr>
        {% empty %}
        <tr><td colspan="12">هیچ سفارشی ثبت نشده است.</td></tr>
        {% endfor %}
    </table>

    <!-- فعال‌سازی تقویم شمسی و محاسبه خودکار قیمت کل -->
    <script>
    $(document).ready(function() {
        // فعال‌سازی تقویم شمسی
        $("input[type='text'].jalali_date").each(function() {
            $(this).persianDatepicker({
                format: 'YYYY/MM/DD',
                observer: true,
                autoClose: true
            });
        });

        // محاسبه خودکار قیمت کل
        function updateTotalPrice() {
            let unitCount = parseInt($("#id_order-unit_count").val()) || 0;
            let unitPrice = parseFloat($("#id_order-price").val().replace(/,/g, '')) || 0;
            let total = unitCount * unitPrice;
            $("#id_order-total_price").val(total.toLocaleString('en-US'));
        }

        $("#id_order-unit_count, #id_order-price").on('input', updateTotalPrice);
    });
    </script>
</body>
</html>





























